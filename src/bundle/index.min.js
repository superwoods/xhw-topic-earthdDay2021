/**
 * Copyright (c) 2007 - 2021 XINHUANET.com All Rights Reserved.
 * xhw-topic-earthday2021 v0.1.2
 * 2021-04-21 16:28:19
 */

"use strict";function wxShareFn(){var a=window.location.href;window.cbEarthDay2021=function(t){wx.config({debug:!1,appId:t.content.appId,timestamp:t.content.timestamp,nonceStr:t.content.nonceStr,signature:t.content.signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone"]}),wx.ready(function(){wx.checkJsApi({jsApiList:["getNetworkType","previewImage"]});var t="世界地球日",e="让我们一起守护地球",n="http://www.xinhuanet.com/talking/earthday2021/bundle/wxshare.jpg";wx.onMenuShareAppMessage({title:t,desc:e,link:a,imgUrl:n}),wx.onMenuShareTimeline({title:t,link:a,imgUrl:n}),wx.onMenuShareQQ({title:t,desc:e,link:a,imgUrl:n}),wx.onMenuShareWeibo({title:t,desc:e,link:a,imgUrl:n}),wx.onMenuShareQZone({title:t,desc:e,link:a,imgUrl:n})})};var t,e=document.createElement("script");e.src=(t=a.substring(0,a.indexOf("#")<0?void 0:a.indexOf("#")),"http://api.home.news.cn/wx/jsapi.do?callback=cbEarthDay2021&mpId=356&url="+encodeURIComponent(t)),document.querySelector("body").appendChild(e)}!function(t){var n,a,i,s,h=t.document,o="ontouchstart"in t,e=o?"touchstart":"mousedown",r=o?"touchmove":"mousemove",c=o?"touchend":"mouseup";function d(t,e,n,a){this.canvas=t,this.ctx=t.getContext("2d"),this.imgUrl=e,this.timer=null,this.lineWidth=30,this.gap=10,this.$target=n,this.$canvas=a}(t.Eraser=d).prototype={init:function(t){for(var e in t)this[e]=t[e];var n=this,a=new Image;this.canvasWidth=this.canvas.width=Math.min(h.body.offsetWidth,640),a.src=this.imgUrl,a.onload=function(){n.canvasHeight=n.canvasWidth*this.height/this.width,n.canvas.height=n.canvasHeight,n.ctx.drawImage(this,0,0,n.canvasWidth,n.canvasHeight),n.initEvent(),n.$target.height(n.canvasHeight).addClass("addBg")}},initEvent:function(){this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.lineWidth=this.lineWidth,this.ctx.globalCompositeOperation="destination-out",this.tapMoveHandler=this.onTapMove.bind(this),this.tapStartHandler=this.onTapStart.bind(this),this.tapEndHandler=this.onTapEnd.bind(this),this.canvas.addEventListener(e,this.tapStartHandler,!1),this.canvas.addEventListener(c,this.tapEndHandler,!1)},onTapStart:function(t){var e=this;this.$target.find(".handBox").fadeOut(2e3,function(){$(this).remove(),e.$target.addClass("is-ca")}),t.preventDefault(),n=o?t.targetTouches[0].pageX-this.canvas.offsetLeft:t.pageX-this.canvas.offsetLeft,a=o?t.targetTouches[0].pageY-this.canvas.offsetTop:t.pageY-this.canvas.offsetTop,this.ctx.beginPath(),this.ctx.arc(n,a,1,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke(),this.canvas.addEventListener(r,this.tapMoveHandler,!1)},onTapMove:function(t){t.preventDefault();var e=this;this.timer||(this.timer=setTimeout(function(){i=o?t.targetTouches[0].pageX-e.canvas.offsetLeft:t.pageX-e.canvas.offsetLeft,s=o?t.targetTouches[0].pageY-e.canvas.offsetTop:t.pageY-e.canvas.offsetTop,e.ctx.moveTo(n,a),e.ctx.lineTo(i,s),e.ctx.stroke(),n=i,a=s,e.timer=null},40))},onTapEnd:function(t){t.preventDefault();for(var e,n=this,a=0,i=this.ctx.getImageData(0,0,this.canvasWidth,this.canvasHeight),s=0;s<i.width;s+=this.gap)for(var h=0;h<i.height;h+=this.gap)e=4*(h*i.width+s),0<i.data[3+e]&&a++;a/(i.width*i.height/(this.gap*this.gap))<.9?setTimeout(function(){n.removeEvent(),n.$canvas.fadeOut(2e3),n.canvas=null},40):this.canvas.removeEventListener(r,this.tapMoveHandler,!1)},removeEvent:function(){this.canvas.removeEventListener(e,this.tapStartHandler,!1),this.canvas.removeEventListener(c,this.tapEndHandler,!1),this.canvas.removeEventListener(r,this.tapMoveHandler,!1)}}}(window),$(function(){isPc?$("html").addClass("isMdBox"):[1,2,3,4].map(function(t,e){var n=document.querySelector("#canvas"+t);new Eraser(n,"bundle/dirty/high5_0"+(t+1)+".jpg",$(".bgPos"+t),$("#canvas"+t)).init()})}),wxShareFn();