/**
 * Copyright (c) 2007 - 2021 XINHUANET.com All Rights Reserved.
 * xhw-topic-earthday2021 v0.1.6
 * 2021-04-22 17:15:21
 */

"use strict";function wxShareFn(){var i=window.location.href;window.cbEarthDay2021=function(t){wx.config({debug:!1,appId:t.content.appId,timestamp:t.content.timestamp,nonceStr:t.content.nonceStr,signature:t.content.signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone"]}),wx.ready(function(){wx.checkJsApi({jsApiList:["getNetworkType","previewImage"]});var t="世界地球日",e="让我们一起守护地球",n="http://www.xinhuanet.com/talking/earthday2021/bundle/wxshare.jpg";wx.onMenuShareAppMessage({title:t,desc:e,link:i,imgUrl:n}),wx.onMenuShareTimeline({title:t,link:i,imgUrl:n}),wx.onMenuShareQQ({title:t,desc:e,link:i,imgUrl:n}),wx.onMenuShareWeibo({title:t,desc:e,link:i,imgUrl:n}),wx.onMenuShareQZone({title:t,desc:e,link:i,imgUrl:n})})};var t,e=document.createElement("script");e.src=(t=i.substring(0,i.indexOf("#")<0?void 0:i.indexOf("#")),"http://api.home.news.cn/wx/jsapi.do?callback=cbEarthDay2021&mpId=356&url="+encodeURIComponent(t)),document.querySelector("body").appendChild(e)}!function(t){var n,i,a,s,o=t.document,h="ontouchstart"in t,e=h?"touchstart":"mousedown",r=h?"touchmove":"mousemove",c=h?"touchend":"mouseup";function d(t,e,n,i){this.canvas=t,this.ctx=t.getContext("2d"),this.imgUrl=e,this.timer=null,this.lineWidth=30,this.gap=10,this.$target=n,this.$canvas=i}(t.Eraser=d).prototype={init:function(t){for(var e in t)this[e]=t[e];var n=this,i=new Image;this.canvasWidth=this.canvas.width=Math.min(o.body.offsetWidth,640),i.src=this.imgUrl,i.onload=function(){n.canvasHeight=n.canvasWidth*this.height/this.width,n.canvas.height=n.canvasHeight,n.ctx.drawImage(this,0,0,n.canvasWidth,n.canvasHeight),n.initEvent(),n.$target.height(n.canvasHeight).addClass("addBg")}},initEvent:function(){this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.lineWidth=this.lineWidth,this.ctx.globalCompositeOperation="destination-out",this.tapMoveHandler=this.onTapMove.bind(this),this.tapStartHandler=this.onTapStart.bind(this),this.tapEndHandler=this.onTapEnd.bind(this),this.canvas.addEventListener(e,this.tapStartHandler,!1),this.canvas.addEventListener(c,this.tapEndHandler,!1)},onTapStart:function(t){var e=this;this.$target.find(".handBox").fadeOut(2e3,function(){$(this).remove(),e.$target.addClass("is-ca")}),t.preventDefault(),n=h?t.targetTouches[0].pageX-this.canvas.offsetLeft:t.pageX-this.canvas.offsetLeft,i=h?t.targetTouches[0].pageY-this.canvas.offsetTop:t.pageY-this.canvas.offsetTop,this.ctx.beginPath(),this.ctx.arc(n,i,1,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke(),this.canvas.addEventListener(r,this.tapMoveHandler,!1)},onTapMove:function(t){t.preventDefault();var e=this;this.timer||(this.timer=setTimeout(function(){a=h?t.targetTouches[0].pageX-e.canvas.offsetLeft:t.pageX-e.canvas.offsetLeft,s=h?t.targetTouches[0].pageY-e.canvas.offsetTop:t.pageY-e.canvas.offsetTop,e.ctx.moveTo(n,i),e.ctx.lineTo(a,s),e.ctx.stroke(),n=a,i=s,e.timer=null},40))},onTapEnd:function(t){t.preventDefault();for(var e,n=this,i=0,a=this.ctx.getImageData(0,0,this.canvasWidth,this.canvasHeight),s=0;s<a.width;s+=this.gap)for(var o=0;o<a.height;o+=this.gap)e=4*(o*a.width+s),0<a.data[3+e]&&i++;i/(a.width*a.height/(this.gap*this.gap))<.9?setTimeout(function(){n.removeEvent(),n.$canvas.fadeOut(2e3),n.canvas=null},40):this.canvas.removeEventListener(r,this.tapMoveHandler,!1)},removeEvent:function(){this.canvas.removeEventListener(e,this.tapStartHandler,!1),this.canvas.removeEventListener(c,this.tapEndHandler,!1),this.canvas.removeEventListener(r,this.tapMoveHandler,!1)}}}(window),$(function(){var t,e,n;isPc?$("html").addClass("isMdBox"):(t=function(){n.play(),$(".jp-audio").addClass("jp-state-playing")},e=function(){n.pause(),$(".jp-audio").removeClass("jp-state-playing")},[1,2,3,4].map(function(t,e){var n=document.querySelector("#canvas"+t);new Eraser(n,"bundle/dirty/high5_0"+(t+1)+".jpg",$(".bgPos"+t),$("#canvas"+t)).init()}),n=$("#music-audio")[0],0==isDev&&(t(),document.addEventListener("WeixinJSBridgeReady",function(){t()},!1)),$(".icon-music").on("click",function(){$(".jp-audio").hasClass("jp-state-playing")?(e(),document.addEventListener("WeixinJSBridgeReady",function(){e()},!1)):t()}))}),wxShareFn();